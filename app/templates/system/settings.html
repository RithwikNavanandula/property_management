{% extends "base.html" %}
{% block title %}System Settings - {{ settings.APP_NAME }}{% endblock %}
{% block page_title %}System Settings{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3>SMTP Configuration</h3>
    </div>
    <div class="card-body">
        <p style="color:var(--text-secondary); margin-bottom: 20px;">
            The following SMTP settings are currently active in your configuration. To change these, please update your
            <code>.env</code> file and restart the server.
        </p>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">SMTP Server</div>
                <div class="stat-value" style="font-size: 16px;">{{ settings.SMTP_SERVER }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Port</div>
                <div class="stat-value" style="font-size: 16px;">{{ settings.SMTP_PORT }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">From Email</div>
                <div class="stat-value" style="font-size: 16px;">{{ settings.SMTP_FROM_EMAIL }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">TLS Enabled</div>
                <div class="stat-value" style="font-size: 16px;">{{ 'Yes' if settings.SMTP_TLS else 'No' }}</div>
            </div>
        </div>

        <div style="margin-top: 40px; border-top: 1px solid var(--border); padding-top: 20px;">
            <h3>Appearance</h3>
            <p style="color:var(--text-secondary); margin-bottom: 20px;">
                Choose your preferred interface style.
            </p>

            <div class="theme-grid">
                <div class="theme-tile" onclick="setTheme('dark-midnight')" id="theme-dark-midnight">
                    <div class="theme-preview" style="background: #0f1117;">
                        <div style="width:20%; height:100%; background:#1a1d2e; border-right:1px solid #2d3250"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#1e2235; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#2d3250; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Midnight (Dark)</div>
                </div>

                <div class="theme-tile" onclick="setTheme('dark-white')" id="theme-dark-white">
                    <div class="theme-preview" style="background: #ffffff;">
                        <div style="width:20%; height:100%; background:#1a1d2e; border-right:1px solid #e2e8f0"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#f1f5f9; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#e2e8f0; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Corporate Mixed</div>
                </div>

                <div class="theme-tile" onclick="setTheme('light-minimal')" id="theme-light-minimal">
                    <div class="theme-preview" style="background: #ffffff; border:1px solid #e2e8f0">
                        <div style="width:20%; height:100%; background:#f8fafc; border-right:1px solid #e2e8f0"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#f1f5f9; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#e2e8f0; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Minimalist Light</div>
                </div>

                <div class="theme-tile" onclick="setTheme('light-ocean')" id="theme-light-ocean">
                    <div class="theme-preview" style="background: #f0f9ff; border:1px solid #bae6fd">
                        <div style="width:20%; height:100%; background:#e0f2fe; border-right:1px solid #bae6fd"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#ffffff; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#bae6fd; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Ocean Breeze</div>
                </div>

                <div class="theme-tile" onclick="setTheme('dark-oled')" id="theme-dark-oled">
                    <div class="theme-preview" style="background: #000000;">
                        <div style="width:20%; height:100%; background:#000000; border-right:1px solid #222"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#0a0a0a; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#222; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Deep Black (OLED)</div>
                </div>

                <div class="theme-tile" onclick="setTheme('dark-slate')" id="theme-dark-slate">
                    <div class="theme-preview" style="background: #1e293b;">
                        <div style="width:20%; height:100%; background:#0f172a; border-right:1px solid #334155"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#d4af37; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#475569; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Slate & Gold</div>
                </div>

                <div class="theme-tile" onclick="setTheme('light-cloud')" id="theme-light-cloud">
                    <div class="theme-preview" style="background: #f1f5f9; border:1px solid #e2e8f0">
                        <div style="width:20%; height:100%; background:#ffffff; border-right:1px solid #e2e8f0"></div>
                        <div style="flex:1; padding:8px">
                            <div
                                style="width:60%; height:6px; background:#64748b; border-radius:2px; margin-bottom:4px">
                            </div>
                            <div style="width:40%; height:4px; background:#cbd5e1; border-radius:2px"></div>
                        </div>
                    </div>
                    <div class="theme-label">Cloud Gray</div>
                </div>
            </div>
        </div>

        <style>
            .theme-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 20px;
                margin-top: 15px;
            }

            .theme-tile {
                cursor: pointer;
                border-radius: var(--radius-md);
                overflow: hidden;
                transition: var(--transition);
                border: 2px solid transparent;
            }

            .theme-tile:hover {
                transform: translateY(-3px);
            }

            .theme-tile.active {
                border-color: var(--accent);
                background: rgba(108, 92, 231, 0.05);
            }

            .theme-preview {
                height: 100px;
                display: flex;
                border-radius: var(--radius-sm);
                overflow: hidden;
                margin-bottom: 8px;
            }

            .theme-label {
                text-align: center;
                font-size: 13px;
                font-weight: 600;
                padding: 4px;
            }
        </style>

        <div style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px;">
            <h4>Test SMTP Connection</h4>
            <p style="color:var(--text-secondary);">Enter a recipient email address to send a test message using these
                settings.</p>

            <div class="form-row" style="max-width: 500px; margin-top: 15px;">
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">Recipient Email</label>
                    <input type="email" id="testRecipient" class="form-control" placeholder="your-email@example.com"
                        value="{{ user.email }}">
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn btn-primary" onclick="sendTestEmail()" id="testBtn">ðŸ“§ Send Test Email</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function sendTestEmail() {
        const recipient = document.getElementById('testRecipient').value;
        if (!recipient) {
            showToast('Please enter a recipient email', 'error');
            return;
        }

        const btn = document.getElementById('testBtn');
        btn.disabled = true;
        btn.innerText = 'âŒ› Sending...';

        try {
            const resp = await apiFetch('/api/system/email/test', {
                method: 'POST',
                body: JSON.stringify({ recipient })
            });
            showToast(resp.message);
        } catch (e) {
            showToast(e.message, 'error');
        } finally {
            btn.disabled = false;
            btn.innerText = 'ðŸ“§ Send Test Email';
        }
    }

    function setTheme(themeId) {
        document.documentElement.setAttribute('data-theme', themeId);
        localStorage.setItem('app-theme', themeId);

        // Update UI
        document.querySelectorAll('.theme-tile').forEach(t => t.classList.remove('active'));
        const activeTile = document.getElementById(`theme-${themeId}`);
        if (activeTile) activeTile.classList.add('active');
    }

    // Initialize active theme tile
    (function () {
        const currentTheme = localStorage.getItem('app-theme') || 'dark-midnight';
        const activeTile = document.getElementById(`theme-${currentTheme}`);
        if (activeTile) activeTile.classList.add('active');
    })();
</script>
{% endblock %}